Below is a **clean box-arrow UML-style diagram** showing the entire multi-layer mapping engine pipeline.

This is **text-rendered UML**, formatted so you can copy/paste into documentation, Confluence, or code comments.

If you prefer a **PlantUML**, **Mermaid**, or **ASCII art** version, I can provide those too.

---

# ðŸ“¦ **BOXâ€“ARROW UML DIAGRAM (High-Level Architecture)**

```
+-------------------------------------------------------------+
|                     Request (Controller)                    |
|-------------------------------------------------------------|
| - sourceData (JSON)                                         |
| - marketCategory                                            |
| - productType                                               |
| - state                                                     |
| - templateId                                                |
+-------------------------------------------------------------+
                           |
                           v
+-------------------------------------------------------------+
|              Template Resolution Component                  |
|-------------------------------------------------------------|
| Loads YAMLs based on request attributes:                    |
|   - base.yaml                                               |
|   - product/<productType>.yaml                              |
|   - market/<marketCategory>.yaml                            |
|   - state/<state>.yaml                                      |
|   - templates/<templateId>.yaml                             |
+-------------------------------------------------------------+
                           |
                           v
+-------------------------------------------------------------+
|                  YAML Merger (Ordered Overlay)              |
|-------------------------------------------------------------|
| Merge order:                                                |
|   1. base.yaml                                              |
|   2. product-level YAML                                     |
|   3. market-level YAML                                      |
|   4. state-level YAML                                       |
|   5. template YAML (final override)                         |
|                                                             |
| Output:                                                     |
|   - Final Logical Mapping (JSONata/JSONPath rules)          |
|   - Final PDF Field Map                                     |
+-------------------------------------------------------------+
                           |
                           v
+-------------------------------------------------------------+
|                    Mapping Evaluation Engine                |
|-------------------------------------------------------------|
| For each logical field:                                     |
|   - Evaluate JSONata / JSONPath                             |
|   - Execute transformations (masking, formatters, etc.)     |
|   - Apply selection logic (dependents, conditions)          |
| Produces:                                                   |
|   - EvaluatedValueMap<logicalField, value>                  |
+-------------------------------------------------------------+
                           |
                           v
+-------------------------------------------------------------+
|                 Field Binding Resolver                      |
|-------------------------------------------------------------|
| Convert:                                                    |
|   logicalField  ---->  pdfFieldName                         |
|                                                             |
| Build:                                                      |
|   PdfFieldSet<pdfFieldName, evaluatedValue>                 |
+-------------------------------------------------------------+
                           |
                           v
+-------------------------------------------------------------+
|                   PDF Population Engine                     |
|-------------------------------------------------------------|
| - Open AcroForm template                                    |
| - Fill fields                                               |
| - Apply checkboxes/radios                                   |
| - Flatten if required                                       |
| Output:                                                     |
|   Final populated PDF                                       |
+-------------------------------------------------------------+
                           |
                           v
+-------------------------------------------------------------+
|                        Response                             |
|-------------------------------------------------------------|
|    --> Merged PDF                                           |
+-------------------------------------------------------------+
```

---

# ðŸ§© OPTIONAL: Showing Data Models Between Stages

```
Request
   |
   v
[YAML Files Selection]
   |
   v
List<YamlFile>
   |
   v
[YAML Merge Engine]
   |
   v
MergedMapping {
   logicalMappings: Map<String, Expression>
   pdfMappings: Map<String, PdfField>
}
   |
   v
[Evaluation Engine]
   |
   v
EvaluatedValues: Map<String, Object>
   |
   v
[Field Binding Resolver]
   |
   v
PdfFieldAssignments: Map<String, Object>
   |
   v
[PDF Writer]
   |
   v
PDF Document (byte[])
```

---

# ðŸ§± OPTIONAL: UML Component Diagram Version (Component Blocks)

```
+------------------------+          +------------------------+
|  Controller            |          |  Template Repository   |
|------------------------|          |------------------------|
| Receives request       |<-------->| Loads YAML sources     |
+-----------+------------+          +------------------------+
            |
            v
+------------------------+
| Template Resolver      |
+------------------------+
            |
            v
+------------------------+
| YAML Merge Engine      |
+------------------------+
            |
            v
+------------------------+
| Mapping Evaluator      |
+------------------------+
            |
            v
+------------------------+
| Field Binding Resolver |
+------------------------+
            |
            v
+------------------------+
| PDF Population Engine  |
+------------------------+
            |
            v
+------------------------+
| Response (PDF bytes)   |
+------------------------+
```

---

# ðŸŽ¨ Want a graphical version?

I can generate:

### âœ” Mermaid

### âœ” PlantUML

### âœ” GraphViz

### âœ” Markdown ASCII

### âœ” SVG-like ASCII diagram

Just tell me the format you want and whether you want **more detail** (class-level, sequence diagram, or component-level).
