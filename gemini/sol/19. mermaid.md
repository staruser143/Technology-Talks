Here is a **clean, production-ready Mermaid diagram** of the full mapping engine flow.

You can paste this directly into:

* Mermaid Live Editor
* GitHub Markdown
* Confluence (with Mermaid plugin)
* MkDocs / Docusaurus
* Notion (supports Mermaid)

---

# ðŸŒ **Mermaid Diagram â€” Multi-Layer Mapping Engine**

```mermaid
flowchart TD

    %% ============================
    %% Inputs
    %% ============================

    A[Request (Controller)\n- sourceData (JSON)\n- marketCategory\n- productType\n- state\n- templateId] --> B

    %% ============================
    %% Template Resolution
    %% ============================

    B[Template Resolution Engine\nLoads YAML files:\nâ€¢ base.yaml\nâ€¢ product/<product>.yaml\nâ€¢ market/<market>.yaml\nâ€¢ state/<state>.yaml\nâ€¢ templates/<templateId>.yaml] --> C

    %% ============================
    %% YAML Merge
    %% ============================

    C[YAML Merger (Ordered Overlay)\nMerge Order:\n1. base\n2. product\n3. market\n4. state\n5. template\nOutput:\nâ€¢ Final Logical Mapping\nâ€¢ Final PDF Field Mapping] --> D

    %% ============================
    %% Mapping Evaluation
    %% ============================

    D[Mapping Evaluation Engine\nâ€¢ Evaluate JSONPath / JSONata\nâ€¢ Apply transformations\nâ€¢ Build logical field values] --> E

    %% ============================
    %% Field Binding
    %% ============================

    E[Field Binding Resolver\nMap:\nlogicalField â†’ pdfField\nOutput:\nPdfFieldAssignments] --> F

    %% ============================
    %% PDF Filling
    %% ============================

    F[PDF Population Engine\nâ€¢ Populate AcroForm fields\nâ€¢ Fill checkboxes & radios\nâ€¢ Flatten PDF] --> G

    %% ============================
    %% Output
    %% ============================

    G[Response (Merged PDF)]
```

---

# ðŸŽ¯ Notes About This Mermaid Diagram

* Designed to model your **full logical â†’ PDF flow**
* Follows strict layer separation (base â†’ product â†’ market â†’ state â†’ template)
* Shows each step of the pipeline clearly
* Works correctly in Mermaid Live Editor without modifications

---

# ðŸ”§ Want a **Sequence Diagram** version?

I can also produce this as:

### âœ” Mermaid `sequenceDiagram`

### âœ” Mermaid `classDiagram` (for Java engine architecture)

### âœ” Mermaid `stateDiagram-v2` (for template selection state machine)

### âœ” Mermaid `flowchart LR` instead of TD

Just tell me what you want next.
