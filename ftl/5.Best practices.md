When designing **complex and dynamic layouts** using the **FreeMarker Template Engine (FTL)**, it’s important to follow best practices that ensure maintainability, scalability, and clarity. Here are the key guidelines:

***

### ✅ **1. Separate Layout from Content**

*   **Use macros and includes**:
    *   Define reusable components (headers, footers, navigation bars) as macros or separate `.ftl` files.
    *   Example:
        ```ftl
        <#include "header.ftl">
        <#include "footer.ftl">
        ```
*   Keep business logic out of templates—templates should only handle presentation.

***

### ✅ **2. Use a Consistent Layout Structure**

*   Implement a **base layout template** with placeholders for dynamic content.
*   Example:
    ```ftl
    <#macro layout title>
      <html>
        <head><title>${title}</title></head>
        <body>
          <#nested>
        </body>
      </html>
    </#macro>
    ```
*   Then use:
    ```ftl
    <@layout title="Home Page">
      <h1>Welcome!</h1>
    </@layout>
    ```

***

### ✅ **3. Avoid Complex Logic in Templates**

*   **Do not write heavy conditional or looping logic in FTL**.
*   Instead, prepare data in the controller/service layer and pass a clean data model to the template.
*   Keep templates declarative, not procedural.

***

### ✅ **4. Use `#if`, `#switch` Carefully**

*   For dynamic content, use `#if` and `#switch` sparingly.
*   If conditions become too complex, move logic to Java code and pass flags or precomputed values.

***

### ✅ **5. Handle Dynamic Content with Maps and Lists**

*   For dynamic sections (e.g., cards, tables), pass structured data like lists or maps.
*   Example:
    ```ftl
    <#list products as product>
      <div>${product.name} - ${product.price}</div>
    </#list>
    ```

***

### ✅ **6. Use `?default` and Null-Safety**

*   Always handle missing values gracefully:
    ```ftl
    ${user.name?default("Guest")}
    ```

***

### ✅ **7. Internationalization (i18n)**

*   Externalize text strings and use resource bundles for multilingual support.
*   Avoid hardcoding text in templates.

***

### ✅ **8. Performance Considerations**

*   Minimize template nesting and includes.
*   Cache frequently used fragments if possible.
*   Avoid unnecessary loops and conditionals.

***

### ✅ **9. Template Organization**

*   Maintain a clear folder structure:
        /templates
          /layouts
          /partials
          /pages
*   Use naming conventions like `header.ftl`, `footer.ftl`, `base.ftl`.

***

### ✅ **10. Testing and Validation**

*   Validate templates with sample data models.
*   Use FreeMarker’s `TemplateExceptionHandler.RETHROW_HANDLER` in development for debugging.

***

Would you like me to **create a sample architecture for a dynamic layout system using FreeMarker** (with base layout, macros, and dynamic content placeholders)? Or should I **give you a checklist for reviewing FreeMarker templates in large projects**?
