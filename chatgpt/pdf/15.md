Perfect ✅ — let’s now **extend your YAML schema and framework** so it can handle **multi-page templates**, **mixed template types (PDF or HTML)**, and **PDF merging** — all through one **unified YAML configuration**.

This makes your Java library a **generic document composition engine** driven entirely by configuration, with **no code changes required** when templates or mappings evolve.

---

## 🧩 Extended YAML Schema (`document-spec.yaml`)

Here’s how your YAML spec might look now:

```yaml
document:
  name: "ApplicantBundle"
  description: "Combined application document with form pages and summary pages"
  output: "output/final_bundle.pdf"

pages:
  - name: "ApplicantForm"
    type: "acroform"
    template: "templates/applicant_form.pdf"
    mapping: "config/mapping_applicant.yaml"

  - name: "ApplicantSummary"
    type: "freemarker"
    template: "templates/summary.ftl"
    mapping: "config/mapping_summary.yaml"

  - name: "ExistingAnnexure"
    type: "pdf"
    template: "templates/annexure.pdf"
    merge: true  # indicates it’s a static PDF to be appended
```

---

### 🔍 Explanation

| Key             | Description                            |
| --------------- | -------------------------------------- |
| `document.name` | Overall document name                  |
| `pages`         | Ordered list of pages/sections         |
| `type`          | `acroform`, `freemarker`, or `pdf`     |
| `mapping`       | Mapping YAML for data-driven templates |
| `merge`         | If true, merges an existing static PDF |
| `output`        | Final merged PDF output path           |

---

## 🧩 `DocumentSpec.java`

```java
package com.example.pdfgen.config;

import java.util.List;

public class DocumentSpec {
    private DocumentMeta document;
    private List<PageSpec> pages;

    public DocumentMeta getDocument() { return document; }
    public void setDocument(DocumentMeta document) { this.document = document; }

    public List<PageSpec> getPages() { return pages; }
    public void setPages(List<PageSpec> pages) { this.pages = pages; }

    public static class DocumentMeta {
        private String name;
        private String description;
        private String output;

        public String getName() { return name; }
        public void setName(String name) { this.name = name; }

        public String getDescription() { return description; }
        public void setDescription(String description) { this.description = description; }

        public String getOutput() { return output; }
        public void setOutput(String output) { this.output = output; }
    }
}
```

---

## 🧩 `PageSpec.java`

```java
package com.example.pdfgen.config;

public class PageSpec {
    private String name;
    private String type; // "acroform", "freemarker", "pdf"
    private String template;
    private String mapping;
    private boolean merge;

    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    public String getType() { return type; }
    public void setType(String type) { this.type = type; }

    public String getTemplate() { return template; }
    public void setTemplate(String template) { this.template = template; }

    public String getMapping() { return mapping; }
    public void setMapping(String mapping) { this.mapping = mapping; }

    public boolean isMerge() { return merge; }
    public void setMerge(boolean merge) { this.merge = merge; }
}
```

---

## 🧩 `YamlDocumentLoader.java`

```java
package com.example.pdfgen.util;

import com.example.pdfgen.config.DocumentSpec;
import org.yaml.snakeyaml.Yaml;
import org.yaml.snakeyaml.constructor.Constructor;

import java.io.FileInputStream;
import java.io.InputStream;

public class YamlDocumentLoader {
    public static DocumentSpec load(String path) throws Exception {
        Yaml yaml = new Yaml(new Constructor(DocumentSpec.class));
        try (InputStream is = new FileInputStream(path)) {
            return yaml.load(is);
        }
    }
}
```

---

## 🧩 `UnifiedDocumentProcessor.java`

This is the **main orchestration class** that handles:

* Each page type (AcroForm, Freemarker, or static PDF)
* Merging all outputs into one final PDF

```java
package com.example.pdfgen.processor;

import com.example.pdfgen.config.DocumentSpec;
import com.example.pdfgen.config.PageSpec;
import com.example.pdfgen.util.YamlDocumentLoader;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.apache.pdfbox.multipdf.PDFMergerUtility;

import java.io.File;
import java.util.ArrayList;
import java.util.List;

public class UnifiedDocumentProcessor {

    private final AcroFormProcessor acroProcessor = new AcroFormProcessor();
    private final FreemarkerHtmlProcessor htmlProcessor = new FreemarkerHtmlProcessor();
    private final ObjectMapper mapper = new ObjectMapper();

    public void generate(String docSpecPath, String jsonDataPath) throws Exception {
        DocumentSpec docSpec = YamlDocumentLoader.load(docSpecPath);
        File jsonFile = new File(jsonDataPath);

        List<File> generatedPdfs = new ArrayList<>();

        for (PageSpec page : docSpec.getPages()) {
            File templateFile = new File(page.getTemplate());
            File tempOutput = File.createTempFile(page.getName(), ".pdf");

            switch (page.getType().toLowerCase()) {
                case "acroform":
                    acroProcessor.fillForm(templateFile, jsonFile, new File(page.getMapping()), tempOutput);
                    generatedPdfs.add(tempOutput);
                    break;

                case "freemarker":
                    htmlProcessor.generatePdf(templateFile, jsonFile, new File(page.getMapping()), tempOutput);
                    generatedPdfs.add(tempOutput);
                    break;

                case "pdf":
                    if (page.isMerge()) {
                        generatedPdfs.add(templateFile);
                    }
                    break;

                default:
                    throw new IllegalArgumentException("Unknown page type: " + page.getType());
            }
        }

        // Merge all generated PDFs into final output
        mergePdfs(generatedPdfs, new File(docSpec.getDocument().getOutput()));
    }

    private void mergePdfs(List<File> pdfFiles, File outputFile) throws Exception {
        PDFMergerUtility merger = new PDFMergerUtility();
        merger.setDestinationFileName(outputFile.getAbsolutePath());

        for (File f : pdfFiles) {
            merger.addSource(f);
        }
        merger.mergeDocuments(null);

        System.out.println("✅ Final merged PDF generated at: " + outputFile.getAbsolutePath());
    }
}
```

---

## 🧩 Example Usage

```java
new UnifiedDocumentProcessor().generate(
    "config/document-spec.yaml",
    "data/applicant_data.json"
);
```

This command will:

1. Read your `document-spec.yaml`
2. Process each page in order:

   * Fill AcroForm fields
   * Render Freemarker HTML to PDF
   * Merge any existing annexure PDFs
3. Produce a **final combined PDF**

---

## 🧩 Directory Structure

```
project-root/
│
├── src/main/java/com/example/pdfgen/
│   ├── config/
│   │   ├── DocumentSpec.java
│   │   ├── PageSpec.java
│   │   ├── FieldMapping.java
│   │   └── PdfMappingConfig.java
│   ├── processor/
│   │   ├── AcroFormProcessor.java
│   │   ├── FreemarkerHtmlProcessor.java
│   │   └── UnifiedDocumentProcessor.java
│   └── util/
│       ├── YamlConfigLoader.java
│       └── YamlDocumentLoader.java
│
├── templates/
│   ├── applicant_form.pdf
│   ├── summary.ftl
│   └── annexure.pdf
│
├── config/
│   ├── mapping_applicant.yaml
│   ├── mapping_summary.yaml
│   └── document-spec.yaml
│
└── data/
    └── applicant_data.json
```

---

## ✅ Key Advantages

| Feature                       | Description                                        |
| ----------------------------- | -------------------------------------------------- |
| **Unified Config**            | All templates (PDF or HTML) managed in one YAML    |
| **No Code Changes**           | Just edit YAML for new pages/templates             |
| **Supports Arrays, Grouping** | Nested, repeated JSON arrays handled automatically |
| **PDF Merging**               | Built-in merging via PDFBox                        |
| **Templating Flexibility**    | Choose between AcroForm or Freemarker              |
| **Extendable**                | Add Markdown → PDF, or Word → PDF later easily     |

---

Would you like me to now extend this further to support **conditional inclusion of pages** (for example, “include spouse summary only if applicantList has a spouse”)?
That would make it a complete **dynamic document assembly engine**.
