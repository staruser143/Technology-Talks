Perfect üî• ‚Äî let‚Äôs now bring everything together into a **fully working, unified Java library** that:

‚úÖ Reads YAML configuration
‚úÖ Accepts JSON data
‚úÖ Applies nested field mappings
‚úÖ Supports chained transforms (via registry) and scripts
‚úÖ Generates output as:

* üßæ AcroForm-filled PDF (via PDFBox 2.0.7)
* üß© Freemarker-based HTML ‚Üí rendered as PDF

All using one **unified processing layer**.

---

# üß± Project Structure

```
pdfgen/
‚îú‚îÄ‚îÄ pom.xml
‚îú‚îÄ‚îÄ src/main/java/com/example/pdfgen/
‚îÇ   ‚îú‚îÄ‚îÄ PdfGeneratorApp.java
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TemplateConfig.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FieldMapping.java
‚îÇ   ‚îú‚îÄ‚îÄ processor/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TemplateProcessor.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AcroFormProcessor.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FreemarkerProcessor.java
‚îÇ   ‚îî‚îÄ‚îÄ util/
‚îÇ       ‚îú‚îÄ‚îÄ TransformRegistry.java
‚îÇ       ‚îî‚îÄ‚îÄ TransformEngine.java
‚îî‚îÄ‚îÄ src/main/resources/
    ‚îú‚îÄ‚îÄ config.yaml
    ‚îú‚îÄ‚îÄ templates/
    ‚îÇ   ‚îú‚îÄ‚îÄ applicant_form.html
    ‚îÇ   ‚îî‚îÄ‚îÄ applicant_form.pdf
    ‚îî‚îÄ‚îÄ data.json
```

---

# üß© 1Ô∏è‚É£ `pom.xml`

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>com.example</groupId>
  <artifactId>pdfgen</artifactId>
  <version>1.0-SNAPSHOT</version>

  <dependencies>
    <!-- PDFBox -->
    <dependency>
      <groupId>org.apache.pdfbox</groupId>
      <artifactId>pdfbox</artifactId>
      <version>2.0.7</version>
    </dependency>

    <!-- Freemarker -->
    <dependency>
      <groupId>org.freemarker</groupId>
      <artifactId>freemarker</artifactId>
      <version>2.3.31</version>
    </dependency>

    <!-- YAML Parser -->
    <dependency>
      <groupId>org.yaml</groupId>
      <artifactId>snakeyaml</artifactId>
      <version>2.2</version>
    </dependency>

    <!-- JSON Parsing -->
    <dependency>
      <groupId>com.fasterxml.jackson.core</groupId>
      <artifactId>jackson-databind</artifactId>
      <version>2.17.0</version>
    </dependency>

    <!-- MVEL for scripting -->
    <dependency>
      <groupId>org.mvel</groupId>
      <artifactId>mvel2</artifactId>
      <version>2.5.0.Final</version>
    </dependency>

    <!-- PDF to HTML conversion -->
    <dependency>
      <groupId>org.xhtmlrenderer</groupId>
      <artifactId>flying-saucer-pdf</artifactId>
      <version>9.1.22</version>
    </dependency>
  </dependencies>
</project>
```

---

# üß© 2Ô∏è‚É£ YAML Config ‚Äî `config.yaml`

```yaml
template:
  name: "ApplicantForm"
  type: "acroform"
  path: "templates/applicant_form.pdf"

mappings:
  - source: applicantList[]
    groupBy: relationship
    fields:
      - source: fname
        target: "{group}.fname.{index}"
        transforms:
          - name: trim
          - name: capitalize
      - source: lname
        target: "{group}.lname.{index}"
        transforms:
          - name: upper
      - source: dob
        target: "{group}.dob.{index}"
        transforms:
          - name: dateFormat
            params:
              from: yyyy-MM-dd
              to: dd/MM/yyyy
      - source: phone
        target: "{group}.phone.{index}"
        transforms:
          - name: maskLast4
```

---

# üß© 3Ô∏è‚É£ JSON Input ‚Äî `data.json`

```json
{
  "applicantList": [
    { "relationship": "Primary", "fname": "john", "lname": "doe", "dob": "1988-01-20", "phone": "9876543210" },
    { "relationship": "Spouse", "fname": "jane", "lname": "doe", "dob": "1990-02-10", "phone": "9876500000" },
    { "relationship": "Child", "fname": "lisa", "lname": "doe", "dob": "2015-03-15", "phone": "9876501111" }
  ]
}
```

---

# üß© 4Ô∏è‚É£ Configuration Classes

### `TemplateConfig.java`

```java
package com.example.pdfgen.config;

import java.util.List;

public class TemplateConfig {
    private Template template;
    private List<FieldMapping> mappings;

    public Template getTemplate() { return template; }
    public void setTemplate(Template template) { this.template = template; }

    public List<FieldMapping> getMappings() { return mappings; }
    public void setMappings(List<FieldMapping> mappings) { this.mappings = mappings; }

    public static class Template {
        private String name;
        private String type;
        private String path;

        public String getName() { return name; }
        public void setName(String name) { this.name = name; }

        public String getType() { return type; }
        public void setType(String type) { this.type = type; }

        public String getPath() { return path; }
        public void setPath(String path) { this.path = path; }
    }
}
```

### `FieldMapping.java`

*(same as previous step with chained transforms support)*

---

# üß© 5Ô∏è‚É£ Unified Processor Interface

### `TemplateProcessor.java`

```java
package com.example.pdfgen.processor;

import com.example.pdfgen.config.TemplateConfig;
import com.fasterxml.jackson.databind.JsonNode;

public interface TemplateProcessor {
    void process(TemplateConfig config, JsonNode data, String outputPath) throws Exception;
}
```

---

# üß© 6Ô∏è‚É£ PDF Processor

### `AcroFormProcessor.java`

```java
package com.example.pdfgen.processor;

import com.example.pdfgen.config.FieldMapping;
import com.example.pdfgen.config.TemplateConfig;
import com.example.pdfgen.util.TransformEngine;
import com.fasterxml.jackson.databind.JsonNode;
import org.apache.pdfbox.pdmodel.*;
import org.apache.pdfbox.pdmodel.interactive.form.*;

import java.io.File;
import java.util.*;

public class AcroFormProcessor implements TemplateProcessor {

    @Override
    public void process(TemplateConfig config, JsonNode data, String outputPath) throws Exception {
        PDDocument doc = PDDocument.load(new File(config.getTemplate().getPath()));
        PDAcroForm acroForm = doc.getDocumentCatalog().getAcroForm();

        for (FieldMapping mapping : config.getMappings()) {
            JsonNode array = data.path(mapping.getSource().replace("[]", ""));
            if (array.isArray()) {
                int idx = 1;
                for (JsonNode element : array) {
                    String group = element.path(mapping.getGroupBy()).asText().toLowerCase(Locale.ROOT);
                    for (FieldMapping field : mapping.getFields()) {
                        Object rawVal = element.path(field.getSource()).asText();
                        Map<String, Object> context = new HashMap<>();
                        element.fieldNames().forEachRemaining(n -> context.put(n, element.path(n).asText()));

                        String value = TransformEngine.apply(rawVal, field.getTransforms(), context);
                        String target = field.getTarget()
                                             .replace("{group}", group)
                                             .replace("{index}", String.valueOf(idx));
                        PDField pdfField = acroForm.getField(target);
                        if (pdfField != null) pdfField.setValue(value);
                    }
                    idx++;
                }
            }
        }

        doc.save(outputPath);
        doc.close();
        System.out.println("‚úÖ AcroForm PDF generated at: " + outputPath);
    }
}
```

---

# üß© 7Ô∏è‚É£ Freemarker Processor

### `FreemarkerProcessor.java`

```java
package com.example.pdfgen.processor;

import com.example.pdfgen.config.FieldMapping;
import com.example.pdfgen.config.TemplateConfig;
import com.example.pdfgen.util.TransformEngine;
import com.fasterxml.jackson.databind.JsonNode;
import freemarker.template.*;
import org.xhtmlrenderer.pdf.ITextRenderer;

import java.io.*;
import java.util.*;

public class FreemarkerProcessor implements TemplateProcessor {

    @Override
    public void process(TemplateConfig config, JsonNode data, String outputPath) throws Exception {
        Configuration cfg = new Configuration(Configuration.VERSION_2_3_31);
        cfg.setDirectoryForTemplateLoading(new File("src/main/resources/templates"));
        cfg.setDefaultEncoding("UTF-8");

        Map<String, Object> model = new HashMap<>();
        for (FieldMapping mapping : config.getMappings()) {
            JsonNode arr = data.path(mapping.getSource().replace("[]", ""));
            if (arr.isArray()) {
                List<Map<String, String>> mappedList = new ArrayList<>();
                int idx = 1;
                for (JsonNode element : arr) {
                    Map<String, String> item = new HashMap<>();
                    String group = element.path(mapping.getGroupBy()).asText();
                    for (FieldMapping field : mapping.getFields()) {
                        Object val = element.path(field.getSource()).asText();
                        Map<String, Object> ctx = new HashMap<>();
                        element.fieldNames().forEachRemaining(n -> ctx.put(n, element.path(n).asText()));
                        String transformed = TransformEngine.apply(val, field.getTransforms(), ctx);
                        item.put(field.getTarget()
                                      .replace("{group}", group)
                                      .replace("{index}", String.valueOf(idx)), transformed);
                    }
                    mappedList.add(item);
                    idx++;
                }
                model.put(mapping.getSource().replace("[]", ""), mappedList);
            }
        }

        Template template = cfg.getTemplate(new File(config.getTemplate().getPath()).getName());
        StringWriter writer = new StringWriter();
        template.process(model, writer);

        // Render HTML ‚Üí PDF
        ITextRenderer renderer = new ITextRenderer();
        renderer.setDocumentFromString(writer.toString());
        renderer.layout();
        renderer.createPDF(new FileOutputStream(outputPath));

        System.out.println("‚úÖ Freemarker PDF generated at: " + outputPath);
    }
}
```

---

# üß© 8Ô∏è‚É£ Unified Runner

### `PdfGeneratorApp.java`

```java
package com.example.pdfgen;

import com.example.pdfgen.config.TemplateConfig;
import com.example.pdfgen.processor.*;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.yaml.snakeyaml.Yaml;

import java.io.*;
import java.util.Map;

public class PdfGeneratorApp {

    public static void main(String[] args) throws Exception {
        Yaml yaml = new Yaml();
        try (InputStream in = new FileInputStream("src/main/resources/config.yaml")) {
            Map<String, Object> yamlMap = yaml.load(in);
            ObjectMapper mapper = new ObjectMapper();
            TemplateConfig config = mapper.convertValue(yamlMap, TemplateConfig.class);

            JsonNode data = mapper.readTree(new File("src/main/resources/data.json"));

            TemplateProcessor processor = switch (config.getTemplate().getType().toLowerCase()) {
                case "acroform" -> new AcroFormProcessor();
                case "freemarker" -> new FreemarkerProcessor();
                default -> throw new IllegalArgumentException("Unknown template type");
            };

            processor.process(config, data, "output.pdf");
        }
    }
}
```

---

# üß© 9Ô∏è‚É£ Freemarker Template Example

`templates/applicant_form.html`

```html
<!DOCTYPE html>
<html>
<head><title>Applicant List</title></head>
<body>
  <h1>Applicants</h1>
  <#list applicantList as a>
    <p><b>${a["Primary.fname.1"]!""} ${a["Primary.lname.1"]!""}</b></p>
    <p>DOB: ${a["Primary.dob.1"]!""}</p>
    <p>Phone: ${a["Primary.phone.1"]!""}</p>
    <hr/>
  </#list>
</body>
</html>
```

---

# ‚úÖ Summary of Capabilities

| Feature                       | Description                            |
| ----------------------------- | -------------------------------------- |
| **Unified YAML**              | Works for both AcroForm and Freemarker |
| **Nested arrays**             | Supports `applicantList[]` and groupBy |
| **Chained transforms**        | Multiple transforms per field          |
| **Custom registry**           | Easily extend with new functions       |
| **Inline scripts (optional)** | Support custom field logic             |
| **PDFBox 2.0.7**              | For interactive form filling           |
| **Freemarker + FlyingSaucer** | For dynamic HTML ‚Üí PDF generation      |

---

Would you like me to extend this to include **inline `script` transformations** *combined with chained transforms* (e.g., transform result of a script or vice versa)? That allows ultimate flexibility like:

```yaml
script: "fname + ' ' + lname"
transforms:
  - name: "title"
```
