Alright üöÄ ‚Äî let‚Äôs **integrate the `TemplateProvider` abstraction into your full PDF workflow engine** so that all templates (forms, cover pages, annexures, summary pages, merged PDFs) are fetched dynamically, whether they come from **local FS or S3**.

---

# ‚úÖ Full Integrated PDF Workflow Engine with `TemplateProvider`

### **1Ô∏è‚É£ YAML Config Example**

```yaml
workflow:
  coverPage:
    template: "coverTemplate.pdf"
    fields:
      title: "Invoice Report"
      date: "2025-10-09"
      customerName: "${customerName}"

  formPages:
    - template: "formTemplate.pdf"
      fieldMapping:
        sourceField1: targetField1
        sourceField2: targetField2

  summaryPage:
    template: "summaryTemplate.pdf"
    fields:
      totalAmount: "${invoiceTotal}"
      itemCount: "${itemCount}"

  annexures:
    - template: "annexure1.pdf"
    - template: "annexure2.pdf"

  merge:
    - "terms.pdf"
    - "legal_disclaimer.pdf"
```

---

### **2Ô∏è‚É£ Core Engine Code**

```java
import org.apache.pdfbox.pdmodel.PDDocument;
import org.apache.pdfbox.pdmodel.interactive.form.PDAcroForm;
import org.apache.pdfbox.pdmodel.interactive.form.PDField;

import java.io.InputStream;
import java.util.List;
import java.util.Map;

public class PdfWorkflowEngine {

    private final TemplateProvider templateProvider;

    public PdfWorkflowEngine(TemplateProvider templateProvider) {
        this.templateProvider = templateProvider;
    }

    /**
     * Fills a PDF form template with data.
     */
    public PDDocument fillForm(String templateName, Map<String, String> fieldValues) throws Exception {
        try (InputStream templateStream = templateProvider.getTemplate(templateName)) {
            PDDocument doc = PDDocument.load(templateStream);
            PDAcroForm form = doc.getDocumentCatalog().getAcroForm();

            if (form != null && fieldValues != null) {
                for (Map.Entry<String, String> entry : fieldValues.entrySet()) {
                    PDField field = form.getField(entry.getKey());
                    if (field != null) {
                        field.setValue(entry.getValue());
                    }
                }
            }
            form.flatten(); // optional: make fields non-editable
            return doc;
        }
    }

    /**
     * Merges multiple PDF documents into one.
     */
    public PDDocument mergeDocuments(List<PDDocument> documents) throws Exception {
        PDDocument finalDoc = new PDDocument();
        for (PDDocument doc : documents) {
            finalDoc.addPage(doc.getPage(0)); // can copy multiple pages if needed
        }
        return finalDoc;
    }
}
```

---

### **3Ô∏è‚É£ Example Usage with Config**

```java
import java.io.File;
import java.io.FileOutputStream;
import java.util.*;

public class PdfWorkflowExample {
    public static void main(String[] args) throws Exception {
        // Example: Local or S3 Provider
        TemplateProvider provider = new LocalTemplateProvider("/opt/app/pdf-templates");
        // Or: new S3TemplateProvider(s3Client, "my-bucket", new File("/tmp/pdf-cache"));

        PdfWorkflowEngine engine = new PdfWorkflowEngine(provider);

        List<PDDocument> docsToMerge = new ArrayList<>();

        // Cover Page
        Map<String, String> coverFields = Map.of(
                "title", "Invoice Report",
                "date", "2025-10-09",
                "customerName", "Acme Corp"
        );
        docsToMerge.add(engine.fillForm("coverTemplate.pdf", coverFields));

        // Form Page
        Map<String, String> formFields = Map.of(
                "targetField1", "Value 1",
                "targetField2", "Value 2"
        );
        docsToMerge.add(engine.fillForm("formTemplate.pdf", formFields));

        // Summary Page
        Map<String, String> summaryFields = Map.of(
                "totalAmount", "1234.56",
                "itemCount", "5"
        );
        docsToMerge.add(engine.fillForm("summaryTemplate.pdf", summaryFields));

        // Annexures
        docsToMerge.add(engine.fillForm("annexure1.pdf", null));
        docsToMerge.add(engine.fillForm("annexure2.pdf", null));

        // Additional PDFs to merge (like legal terms)
        docsToMerge.add(engine.fillForm("terms.pdf", null));

        // Merge all into final PDF
        PDDocument finalDoc = engine.mergeDocuments(docsToMerge);

        // Save final PDF
        finalDoc.save(new FileOutputStream("final-output.pdf"));
        finalDoc.close();

        // Cleanup
        for (PDDocument doc : docsToMerge) {
            doc.close();
        }

        System.out.println("‚úÖ Final PDF generated: final-output.pdf");
    }
}
```

---

### **4Ô∏è‚É£ Key Features**

* **Flexible template location** ‚Üí `LocalTemplateProvider` or `S3TemplateProvider`.
* **Dynamic form filling** ‚Üí Uses mappings from YAML ‚Üí data model ‚Üí PDF fields.
* **Merging** ‚Üí Combines cover, forms, summary, annexures, legal docs into one.
* **Extensible** ‚Üí Add more `TemplateProvider` types (e.g., CMS, DB).
* **Config-driven** ‚Üí YAML defines workflow; code just executes.

---

üëâ Next step could be:

* Parsing the **YAML config into POJOs** (`SnakeYAML`) and wiring them into this engine automatically.

Would you like me to **add the YAML parser + automatic workflow runner** so the engine takes a YAML file as input and produces the final PDF end-to-end?
