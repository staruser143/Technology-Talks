Awesome üéØ Let‚Äôs extend the **YAML-driven PDF workflow engine** so that it can also handle **tables and repeating sections** like invoice line items, summary rows, etc.

This is a big step because **AcroForms (PDF forms)** are limited for dynamic content, so we‚Äôll use **PDFBox drawing API** (`PDPageContentStream`) to render repeating rows (tables) dynamically.

---

# ‚úÖ Extended YAML Workflow with Tables

### **1Ô∏è‚É£ Example Config (YAML)**

```yaml
workflow:
  coverPage:
    template: "coverTemplate.pdf"
    fields:
      title: "Invoice Report"
      date: "${currentDate}"
      customerName: "${customerName}"

  formPages:
    - template: "formTemplate.pdf"
      fieldMapping:
        sourceField1: targetField1
        sourceField2: targetField2

  summaryPage:
    template: "summaryTemplate.pdf"
    fields:
      totalAmount: "${invoiceTotal}"
      itemCount: "${itemCount}"

  tables:
    - title: "Invoice Line Items"
      dataKey: "items"
      columns:
        - header: "Item"
          field: "name"
          width: 200
        - header: "Quantity"
          field: "qty"
          width: 80
        - header: "Price"
          field: "price"
          width: 100
        - header: "Total"
          field: "total"
          width: 100

  annexures:
    - template: "annexure1.pdf"

  merge:
    - "terms.pdf"
```

---

### **2Ô∏è‚É£ Extend POJOs to Support Tables**

```java
import java.util.List;

public class TableConfig {
    public String title;
    public String dataKey; // key in data map for repeating rows
    public List<Column> columns;

    public static class Column {
        public String header;
        public String field;
        public int width;
    }
}
```

Extend `WorkflowConfig`:

```java
public class WorkflowConfig {
    public CoverPage coverPage;
    public List<FormPage> formPages;
    public SummaryPage summaryPage;
    public List<Annexure> annexures;
    public List<String> merge;
    public List<TableConfig> tables; // NEW
}
```

---

### **3Ô∏è‚É£ Table Drawing Utility**

```java
import org.apache.pdfbox.pdmodel.PDDocument;
import org.apache.pdfbox.pdmodel.PDPage;
import org.apache.pdfbox.pdmodel.PDPageContentStream;
import org.apache.pdfbox.pdmodel.common.PDRectangle;
import org.apache.pdfbox.pdmodel.font.PDType1Font;

import java.io.IOException;
import java.util.List;
import java.util.Map;

public class PdfTableRenderer {

    public static PDDocument renderTable(TableConfig tableConfig, List<Map<String, Object>> rows) throws IOException {
        PDDocument doc = new PDDocument();
        PDPage page = new PDPage(PDRectangle.A4);
        doc.addPage(page);

        try (PDPageContentStream content = new PDPageContentStream(doc, page)) {
            float margin = 50;
            float yStart = page.getMediaBox().getHeight() - margin;
            float yPosition = yStart;

            // Title
            content.beginText();
            content.setFont(PDType1Font.HELVETICA_BOLD, 14);
            content.newLineAtOffset(margin, yPosition);
            content.showText(tableConfig.title);
            content.endText();

            yPosition -= 30;

            // Headers
            float x = margin;
            content.setFont(PDType1Font.HELVETICA_BOLD, 10);
            for (TableConfig.Column col : tableConfig.columns) {
                content.beginText();
                content.newLineAtOffset(x, yPosition);
                content.showText(col.header);
                content.endText();
                x += col.width;
            }
            yPosition -= 20;

            // Rows
            content.setFont(PDType1Font.HELVETICA, 10);
            for (Map<String, Object> row : rows) {
                x = margin;
                for (TableConfig.Column col : tableConfig.columns) {
                    String value = row.get(col.field) != null ? row.get(col.field).toString() : "";
                    content.beginText();
                    content.newLineAtOffset(x, yPosition);
                    content.showText(value);
                    content.endText();
                    x += col.width;
                }
                yPosition -= 15;

                if (yPosition < margin) {
                    // add new page if overflow
                    content.close();
                    page = new PDPage(PDRectangle.A4);
                    doc.addPage(page);
                    yPosition = yStart;
                }
            }
        }
        return doc;
    }
}
```

---

### **4Ô∏è‚É£ Extend Workflow Runner**

```java
public void runWorkflow(WorkflowConfig config, Map<String, Object> data, String outputFile) throws Exception {
    List<PDDocument> docs = new ArrayList<>();

    // ... existing cover, forms, summary, annexures, merge ...

    // Tables (dynamic content)
    if (config.tables != null) {
        for (TableConfig tableConfig : config.tables) {
            Object rowsObj = data.get(tableConfig.dataKey);
            if (rowsObj instanceof List) {
                @SuppressWarnings("unchecked")
                List<Map<String, Object>> rows = (List<Map<String, Object>>) rowsObj;
                PDDocument tableDoc = PdfTableRenderer.renderTable(tableConfig, rows);
                docs.add(tableDoc);
            }
        }
    }

    // Merge final document
    PDDocument finalDoc = engine.mergeDocuments(docs);
    finalDoc.save(new FileOutputStream(outputFile));
    finalDoc.close();
    for (PDDocument d : docs) d.close();

    System.out.println("‚úÖ Final PDF generated: " + outputFile);
}
```

---

### **5Ô∏è‚É£ Example Input Data (JSON ‚Üí Map)**

```json
{
  "customerName": "Acme Corp",
  "currentDate": "2025-10-09",
  "sourceField1": "Foo",
  "sourceField2": "Bar",
  "invoiceTotal": 1234.56,
  "itemCount": 5,
  "items": [
    { "name": "Product A", "qty": 2, "price": 100, "total": 200 },
    { "name": "Product B", "qty": 1, "price": 300, "total": 300 },
    { "name": "Product C", "qty": 5, "price": 50, "total": 250 }
  ]
}
```

---

# ‚úÖ What We Added

1. **Tables in YAML** (`tables:` section).
2. **Dynamic data rendering** (loop rows).
3. **Overflow handling** (adds new pages when table exceeds page size).
4. **Full integration with existing PDF engine**.

---

üëâ Next step could be to make tables **more advanced**:

* Auto-fit column widths.
* Borders + alternating row colors.
* Multi-line text wrapping in cells.
* Pagination headers (repeat table headers on new pages).

Would you like me to extend this to **pretty tables with borders, alternating row colors, and repeated headers** so it looks like a real invoice table?
