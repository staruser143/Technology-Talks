Below is a **complete, realistic, end-to-end rendering specification** for a **5-page client document**, designed to illustrate:

* Multiple pages with **different layouts**
* **Conditional pages**
* **Preprocessing / derived data**
* **Tables, nested tables, and text sections**
* Reuse of data across pages
* Clear separation between **structure**, **logic**, and **presentation**

This is intentionally verbose and annotated so you can *reason about it*, not just skim it.

---

# FULL SAMPLE RENDERING SPEC (5-PAGE DOCUMENT)

```json
{
  "specVersion": "1.0",

  "layouts": {
    "cover-page": {
      "template": "cover-page.ftl"
    },
    "two-column": {
      "template": "two-column.ftl"
    },
    "full-width": {
      "template": "full-width.ftl"
    },
    "addendum": {
      "template": "addendum.ftl"
    }
  },

  "preprocess": [
    {
      "name": "eligibleDependents",
      "expression": "$.dependents[?(@.age < 26)]"
    },
    {
      "name": "hasDependents",
      "expression": "$.dependents.length > 0"
    },
    {
      "name": "hasCoverages",
      "expression": "$.coverages.length > 0"
    },
    {
      "name": "medicalCoverages",
      "expression": "$.coverages[?(@.type == 'MEDICAL')]"
    }
  ],

  "document": {
    "pages": [

      /* ----------------------------------------------------
         PAGE 1 — COVER PAGE (STATIC + DYNAMIC TEXT)
         ---------------------------------------------------- */
      {
        "id": "coverPage",
        "layout": "cover-page",
        "sections": [
          {
            "type": "text",
            "id": "docTitle",
            "value": "Enrollment Summary"
          },
          {
            "type": "text",
            "id": "applicantName",
            "value": "${request.applicant.firstName} ${request.applicant.lastName}"
          },
          {
            "type": "text",
            "id": "submissionDate",
            "value": "${request.submissionDate}"
          }
        ]
      },

      /* ----------------------------------------------------
         PAGE 2 — APPLICANT DETAILS (CONDITIONAL SECTIONS)
         ---------------------------------------------------- */
      {
        "id": "applicantDetails",
        "layout": "two-column",
        "sections": [
          {
            "type": "table",
            "id": "applicantInfo",
            "rowSource": {
              "type": "path",
              "path": "request.applicant"
            },
            "columns": [
              {
                "name": "firstName",
                "label": "First Name",
                "field": "firstName"
              },
              {
                "name": "lastName",
                "label": "Last Name",
                "field": "lastName"
              },
              {
                "name": "dob",
                "label": "Date of Birth",
                "field": "dob",
                "format": "date"
              }
            ]
          }
        ]
      },

      /* ----------------------------------------------------
         PAGE 3 — DEPENDENTS (CONDITIONAL PAGE)
         ---------------------------------------------------- */
      {
        "id": "dependentsPage",
        "layout": "full-width",
        "visibleWhen": "$.hasDependents == true",
        "sections": [
          {
            "type": "table",
            "id": "dependentsTable",
            "rowSource": {
              "type": "path",
              "path": "eligibleDependents"
            },
            "columns": [
              {
                "name": "name",
                "label": "Name",
                "field": "name"
              },
              {
                "name": "age",
                "label": "Age",
                "field": "age"
              },
              {
                "name": "relationship",
                "label": "Relationship",
                "field": "relationship"
              }
            ]
          }
        ]
      },

      /* ----------------------------------------------------
         PAGE 4 — COVERAGES WITH NESTED TABLES
         ---------------------------------------------------- */
      {
        "id": "coveragePage",
        "layout": "full-width",
        "visibleWhen": "$.hasCoverages == true",
        "sections": [
          {
            "type": "table",
            "id": "coverageTable",
            "rowSource": {
              "type": "path",
              "path": "medicalCoverages"
            },
            "columns": [
              {
                "name": "coverageType",
                "label": "Coverage Type",
                "field": "type"
              },
              {
                "name": "benefits",
                "label": "Benefits",
                "nestedTable": {
                  "rowSource": {
                    "type": "path",
                    "path": "benefits"
                  },
                  "columns": [
                    {
                      "name": "code",
                      "label": "Code",
                      "field": "code"
                    },
                    {
                      "name": "description",
                      "label": "Description",
                      "field": "description"
                    }
                  ]
                }
              }
            ]
          }
        ]
      },

      /* ----------------------------------------------------
         PAGE 5 — ADDENDUM / DECLARATIONS
         ---------------------------------------------------- */
      {
        "id": "declarationPage",
        "layout": "addendum",
        "sections": [
          {
            "type": "text",
            "id": "declarationText",
            "value": "I hereby declare that the information provided is accurate."
          },
          {
            "type": "text",
            "id": "signature",
            "value": "Signature: _______________________"
          }
        ]
      }

    ]
  }
}
```

---

# HOW TO READ THIS SPEC (IMPORTANT)

## 1. Client Variability Is Entirely Declarative

* Different clients → different JSON specs
* Same service, same engine

---

## 2. Pages Are Independent Units

Each page:

* Has its own layout
* Owns its own visibility
* Has its own data needs

---

## 3. Preprocessing Enables Page-Specific Data

Example:

```json
"eligibleDependents": "$.dependents[?(@.age < 26)]"
```

Used only by Page 3 — not recomputed elsewhere.

---

## 4. Nested Tables Are Explicit

Coverage → Benefits is modeled cleanly:

* No FreeMarker loops
* No client Java code
* Unlimited depth if required

---

## 5. Templates Remain Generic

Your `full-width.ftl` template can render:

* Any table
* Any nested table
* Any section order

---

# HOW THE SERVICE USES THIS (SUMMARY FLOW)

```
Request JSON
   ↓
Preprocessing (expressions)
   ↓
Page Evaluation (visibleWhen)
   ↓
Section Builders
   ↓
DocumentViewModel
   ↓
Renderer (FTL / AcroForm)
   ↓
PDF
```

---

# WHY THIS WORKS FOR REAL CLIENTS

| Requirement            | Covered |
| ---------------------- | ------- |
| 5+ pages               | Yes     |
| Different layouts      | Yes     |
| Conditional pages      | Yes     |
| Derived data           | Yes     |
| Nested tables          | Yes     |
| AcroForm compatibility | Yes     |
| Client isolation       | Yes     |
| Zero client Java       | Yes     |

---

# WHAT THIS SPEC DOES **NOT** DO (BY DESIGN)

* No loops
* No code
* No layout math
* No template logic
* No direct PDF field names

That is intentional.

---

## NEXT STEPS (Highly Recommended)

If you want, I can:

1. Show **how this spec maps to AcroForm fields**
2. Provide **a full JSON Schema for this exact spec**
3. Walk through **runtime ViewModel objects**
4. Show **FTL templates for these layouts**
5. Discuss **performance and caching strategies**

Tell me which one you want next.
