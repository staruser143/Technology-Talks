Great question! Testing a PDF form filler like this involves **multiple layers**:  
✅ **Unit tests** for transforms and path resolution  
✅ **Integration tests** for YAML → JSON → PDF flow  
✅ **PDF validation** to ensure fields are correctly filled  

Below is a complete **testing strategy** with **real code examples** using **JUnit 5**, **AssertJ**, and **temporary files**.

---

## 🧪 1. Add Test Dependencies (`pom.xml`)

```xml
<dependency>
  <groupId>org.junit.jupiter</groupId>
  <artifactId>junit-jupiter</artifactId>
  <version>5.10.2</version>
  <scope>test</scope>
</dependency>
<dependency>
  <groupId>org.assertj</groupId>
  <artifactId>assertj-core</artifactId>
  <version>3.25.3</version>
  <scope>test</scope>
</dependency>
```

Enable JUnit 5 in Maven:

```xml
<build>
  <plugins>
    <plugin>
      <groupId>org.apache.maven.plugins</groupId>
      <artifactId>maven-surefire-plugin</artifactId>
      <version>3.2.5</version>
    </plugin>
  </plugins>
</build>
```

---

## 📁 2. Project Test Structure

```
src/
├── main/
│   └── java/PdfFormFiller.java
└── test/
    ├── java/
    │   └── PdfFormFillerTest.java
    └── resources/
        ├── test-template.pdf          ← minimal test PDF
        ├── test-data.json
        └── test-mapping.yaml
```

> 💡 You’ll need a **simple fillable PDF** for testing.  
> → [Download a sample fillable PDF](https://www.pdfscripting.com/public/Free-Sample-PDF-Forms.shtml)  
> → Or create one in **Adobe Acrobat** or **LibreOffice** with fields like `TestField.1`, `Dependent.FName.1`, etc.

---

## 🧪 3. Unit Tests (Isolated Logic)

Test transforms, path resolution, and field name templating **without PDF**.

### `PdfFormFillerTest.java` (Partial)

```java
import org.junit.jupiter.api.Test;
import static org.assertj.core.api.Assertions.*;

class PdfFormFillerTest {

    @Test
    void testApplyTransform_uppercase() {
        assertThat(PdfFormFiller.applyTransform("john", "uppercase"))
            .isEqualTo("JOHN");
    }

    @Test
    void testApplyTransform_date() {
        assertThat(PdfFormFiller.applyTransform("2025-10-25", "date:MM/dd/yyyy"))
            .isEqualTo("10/25/2025");
    }

    @Test
    void testResolvePdfFieldName_withParentIndex() {
        var ctx = new PdfFormFiller.FillContext("{}", 2, 1);
        String result = PdfFormFiller.resolvePdfFieldName("Dep.Addr.Street.{parent_index}.{index}", ctx);
        assertThat(result).isEqualTo("Dep.Addr.Street.1.2");
    }

    @Test
    void testEvaluateRelativeJsonPath() {
        String itemJson = "{\"name\":\"Alice\"}";
        String value = PdfFormFiller.evaluateRelativeJsonPath(itemJson, "$.name");
        assertThat(value).isEqualTo("Alice");
    }
}
```

> 🔒 Make `applyTransform`, `resolvePdfFieldName`, etc. **package-private** (remove `private`) so tests can access them.

---

## 🧪 4. Integration Test (Full Flow)

Test the **entire pipeline**: YAML + JSON → filled PDF → validate field values.

### `PdfFormFillerIntegrationTest.java`

```java
import org.apache.pdfbox.pdmodel.PDDocument;
import org.apache.pdfbox.pdmodel.interactive.form.PDAcroForm;
import org.junit.jupiter.api.*;
import java.io.*;
import java.nio.file.*;

import static org.assertj.core.api.Assertions.*;

class PdfFormFillerIntegrationTest {

    private Path tempOutputPdf;

    @BeforeEach
    void setUp() throws IOException {
        tempOutputPdf = Files.createTempFile("filled_", ".pdf");
    }

    @AfterEach
    void tearDown() throws IOException {
        Files.deleteIfExists(tempOutputPdf);
    }

    @Test
    void fillsPdfFormCorrectly() throws Exception {
        // Arrange: use test resources
        String templatePath = "src/test/resources/test-template.pdf";
        String dataPath = "src/test/resources/test-data.json";
        String mappingPath = "src/test/resources/test-mapping.yaml";

        // Copy resources to temporary files (so paths work)
        Path tempTemplate = Files.createTempFile("template_", ".pdf");
        Path tempData = Files.createTempFile("data_", ".json");
        Path tempMapping = Files.createTempFile("mapping_", ".yaml");

        Files.copy(Paths.get(templatePath), tempTemplate, StandardCopyOption.REPLACE_EXISTING);
        Files.copy(Paths.get(dataPath), tempData, StandardCopyOption.REPLACE_EXISTING);
        Files.copy(Paths.get(mappingPath), tempMapping, StandardCopyOption.REPLACE_EXISTING);

        // Act: run the filler
        PdfFormFiller.main(new String[]{});

        // But better: refactor main logic into a method!
        // Let's assume you add: PdfFormFiller.fillForm(template, data, mapping, output)
        PdfFormFiller.fillForm(
            tempTemplate.toString(),
            tempData.toString(),
            tempMapping.toString(),
            tempOutputPdf.toString()
        );

        // Assert: read filled PDF and check values
        try (PDDocument doc = PDDocument.load(tempOutputPdf.toFile())) {
            PDAcroForm form = doc.getDocumentCatalog().getAcroForm();
            assertThat(form.getField("PrimaryApplicant.FName.1").getValueAsString())
                .isEqualTo("JOHN");

            assertThat(form.getField("Dependent.FName.1").getValueAsString())
                .isEqualTo("Alice");

            assertThat(form.getField("Dependent.Addr.Street.1.1").getValueAsString())
                .isEqualTo("123 Main St");
        }

        // Cleanup
        Files.delete(tempTemplate);
        Files.delete(tempData);
        Files.delete(tempMapping);
    }
}
```

> ⚠️ **Important**: Refactor your `main()` logic into a reusable method:

### Add to `PdfFormFiller.java`

```java
// Replace main() with this, and call it from main()
public static void fillForm(String templatePath, String dataPath, String mappingPath, String outputPath)
    throws Exception {
    
    String jsonText = Files.readString(Paths.get(dataPath));
    ObjectMapper yamlMapper = new ObjectMapper(new YAMLFactory());
    MappingConfig config = yamlMapper.readValue(new File(mappingPath), MappingConfig.class);

    try (PDDocument document = PDDocument.load(new File(templatePath))) {
        PDAcroForm form = document.getDocumentCatalog().getAcroForm();
        if (form == null) throw new IllegalStateException("No form in PDF");

        for (FieldOrBlock block : config.fields()) {
            if (block instanceof SingleField single) {
                fillSingleField(form, jsonText, single);
            } else if (block instanceof RepeatBlock repeat) {
                fillRepeatBlock(form, jsonText, repeat, null);
            }
        }
        document.save(outputPath);
    }
}

// Now main() is just:
public static void main(String[] args) throws Exception {
    fillForm("template.pdf", "data.json", "mapping.yaml", "filled_form.pdf");
}
```

---

## 📄 5. Test Resources

### `src/test/resources/test-data.json`
```json
{
  "primaryApplicant": { "firstName": "john" },
  "dependents": [
    {
      "firstName": "Alice",
      "includeInForm": true,
      "addresses": [
        { "street": "123 Main St" }
      ]
    }
  ]
}
```

### `src/test/resources/test-mapping.yaml`
```yaml
fields:
  - pdf_field: "PrimaryApplicant.FName.1"
    json_path: "$.primaryApplicant.firstName"
    transform: "uppercase"

  - repeat: true
    json_array_path: "$.dependents"
    condition: "$.includeInForm == true"
    items:
      - pdf_field: "Dependent.FName.{index}"
        json_path: "$.firstName"
      - repeat: true
        json_array_path: "$.addresses"
        items:
          - pdf_field: "Dependent.Addr.Street.{parent_index}.{index}"
            json_path: "$.street"
```

### `src/test/resources/test-template.pdf`
- Must contain fields:
  - `PrimaryApplicant.FName.1`
  - `Dependent.FName.1`
  - `Dependent.Addr.Street.1.1`

> 🔧 **Create it**:
> 1. Open LibreOffice Writer
> 2. Insert → Form Control → Text Box
> 3. Right-click → Control → Set **Name** to `PrimaryApplicant.FName.1`
> 4. Export as PDF (ensure "Create PDF form" is checked)

---

## 🧪 6. Run Tests

```bash
mvn test
```

Or in IDE: right-click test class → **Run**

---

## ✅ Testing Checklist

| Test Type | What It Covers |
|---------|----------------|
| **Unit** | Transforms, path resolution, templating |
| **Integration** | Full YAML→JSON→PDF flow |
| **PDF Validation** | Actual field values in output PDF |
| **Edge Cases** | Empty arrays, missing fields, invalid dates |
| **Conditional Logic** | Items skipped when `condition` is false |

---

## 🚀 Bonus: Test Edge Cases

Add these test cases:

```java
@Test
void handlesMissingDependents() throws Exception {
    // data.json with "dependents": []
    // → ensure no error, and no dependent fields filled
}

@Test
void respectsMaxItems() throws Exception {
    // mapping.yaml with max_items: 1
    // data.json with 3 dependents
    // → only Dependent.FName.1 should be filled
}

@Test
void skipsWhenConditionFalse() throws Exception {
    // dependent with "includeInForm": false
    // → field should remain empty
}
```

---

You now have a **robust, automated test suite** that ensures your PDF filler works correctly — even as you add new features!

Let me know if you'd like:
- A script to **generate test PDFs programmatically**
- **Snapshot testing** for PDF output
- **CI/CD integration** (GitHub Actions, etc.)